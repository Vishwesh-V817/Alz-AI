<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clinical Alzheimer's Diagnosis - Test Interface</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 32px;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 14px;
            opacity: 0.9;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 0;
            min-height: 600px;
        }

        .form-section {
            padding: 30px;
            overflow-y: auto;
            max-height: 80vh;
        }

        .result-section {
            background: #f8f9fa;
            padding: 30px;
            border-left: 2px solid #e0e0e0;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .section-title {
            font-size: 18px;
            font-weight: 700;
            color: #667eea;
            margin: 25px 0 15px 0;
            padding-bottom: 8px;
            border-bottom: 2px solid #667eea;
        }

        .section-title:first-child {
            margin-top: 0;
        }

        label {
            display: block;
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
            font-size: 13px;
        }

        input[type="number"],
        select {
            width: 100%;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        input[type="number"]:focus,
        select:focus {
            outline: none;
            border-color: #667eea;
        }

        .input-hint {
            font-size: 11px;
            color: #888;
            margin-top: 3px;
        }

        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 30px;
        }

        button {
            flex: 1;
            padding: 15px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .btn-example {
            background: #28a745;
            color: white;
        }

        .btn-example:hover {
            background: #218838;
        }

        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .result-container {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .result-title {
            font-size: 16px;
            font-weight: 700;
            color: #333;
            margin-bottom: 15px;
        }

        .diagnosis-badge {
            display: inline-block;
            padding: 10px 20px;
            border-radius: 25px;
            font-weight: 700;
            font-size: 18px;
            margin: 10px 0;
        }

        .diagnosis-positive {
            background: #fff3cd;
            color: #856404;
            border: 2px solid #ffc107;
        }

        .diagnosis-negative {
            background: #d4edda;
            color: #155724;
            border: 2px solid #28a745;
        }

        .metric {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid #e0e0e0;
        }

        .metric:last-child {
            border-bottom: none;
        }

        .metric-label {
            font-weight: 600;
            color: #666;
        }

        .metric-value {
            font-weight: 700;
            color: #333;
        }

        .confidence-bar {
            width: 100%;
            height: 25px;
            background: #e0e0e0;
            border-radius: 12px;
            overflow: hidden;
            margin-top: 10px;
        }

        .confidence-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            font-size: 12px;
            transition: width 0.8s ease;
        }

        .risk-indicator {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: 700;
            font-size: 14px;
        }

        .risk-high {
            background: #f8d7da;
            color: #721c24;
        }

        .risk-moderate {
            background: #fff3cd;
            color: #856404;
        }

        .risk-low {
            background: #d1ecf1;
            color: #0c5460;
        }

        .risk-very-low {
            background: #d4edda;
            color: #155724;
        }

        .loading {
            text-align: center;
            padding: 40px;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            border: 1px solid #f5c6cb;
        }

        .placeholder-text {
            text-align: center;
            color: #999;
            padding: 60px 20px;
            font-size: 14px;
        }

        /* Radio button groups */
        .radio-group {
            display: flex;
            gap: 20px;
            margin-top: 8px;
        }

        .radio-group label {
            display: flex;
            align-items: center;
            font-weight: 500;
            cursor: pointer;
        }

        .radio-group input[type="radio"] {
            margin-right: 6px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üß† Clinical Alzheimer's Diagnosis</h1>
            <p>Advanced AI-Powered Clinical Assessment Tool</p>
        </div>

        <div class="main-content">
            <div class="form-section">
                <form id="clinicalForm">
                    <!-- Demographics -->
                    <div class="section-title">üìã Demographics</div>
                    <div class="grid-2">
                        <div class="form-group">
                            <label>Age *</label>
                            <input type="number" name="Age" required min="40" max="100" value="72">
                            <div class="input-hint">40-100 years</div>
                        </div>
                        <div class="form-group">
                            <label>Gender *</label>
                            <select name="Gender" required>
                                <option value="0">Male</option>
                                <option value="1" selected>Female</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Ethnicity *</label>
                            <select name="Ethnicity" required>
                                <option value="0" selected>Caucasian</option>
                                <option value="1">African American</option>
                                <option value="2">Asian</option>
                                <option value="3">Other</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Education Level *</label>
                            <select name="EducationLevel" required>
                                <option value="0">None</option>
                                <option value="1">High School</option>
                                <option value="2" selected>Bachelor's</option>
                                <option value="3">Higher</option>
                            </select>
                        </div>
                    </div>

                    <!-- Physical Health -->
                    <div class="section-title">üí™ Physical Health</div>
                    <div class="grid-2">
                        <div class="form-group">
                            <label>BMI *</label>
                            <input type="number" name="BMI" required step="0.1" min="15" max="50" value="26.5">
                            <div class="input-hint">15-50 kg/m¬≤</div>
                        </div>
                        <div class="form-group">
                            <label>Smoking *</label>
                            <select name="Smoking" required>
                                <option value="0" selected>No</option>
                                <option value="1">Yes</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Alcohol Consumption (weekly) *</label>
                            <input type="number" name="AlcoholConsumption" required step="0.1" min="0" max="20" value="3.5">
                            <div class="input-hint">0-20 units/week</div>
                        </div>
                        <div class="form-group">
                            <label>Physical Activity (0-10) *</label>
                            <input type="number" name="PhysicalActivity" required step="0.1" min="0" max="10" value="4.2">
                        </div>
                        <div class="form-group">
                            <label>Diet Quality (0-10) *</label>
                            <input type="number" name="DietQuality" required step="0.1" min="0" max="10" value="6.8">
                        </div>
                        <div class="form-group">
                            <label>Sleep Quality (0-10) *</label>
                            <input type="number" name="SleepQuality" required step="0.1" min="0" max="10" value="5.5">
                        </div>
                    </div>

                    <!-- Medical History -->
                    <div class="section-title">üè• Medical History</div>
                    <div class="grid-2">
                        <div class="form-group">
                            <label>Family History of Alzheimer's *</label>
                            <select name="FamilyHistoryAlzheimers" required>
                                <option value="0">No</option>
                                <option value="1" selected>Yes</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Cardiovascular Disease *</label>
                            <select name="CardiovascularDisease" required>
                                <option value="0" selected>No</option>
                                <option value="1">Yes</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Diabetes *</label>
                            <select name="Diabetes" required>
                                <option value="0">No</option>
                                <option value="1" selected>Yes</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Depression *</label>
                            <select name="Depression" required>
                                <option value="0" selected>No</option>
                                <option value="1">Yes</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Head Injury *</label>
                            <select name="HeadInjury" required>
                                <option value="0" selected>No</option>
                                <option value="1">Yes</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Hypertension *</label>
                            <select name="Hypertension" required>
                                <option value="0">No</option>
                                <option value="1" selected>Yes</option>
                            </select>
                        </div>
                    </div>

                    <!-- Clinical Measurements -->
                    <div class="section-title">ü©∫ Clinical Measurements</div>
                    <div class="grid-2">
                        <div class="form-group">
                            <label>Systolic BP *</label>
                            <input type="number" name="SystolicBP" required step="0.1" min="80" max="200" value="138">
                            <div class="input-hint">80-200 mmHg</div>
                        </div>
                        <div class="form-group">
                            <label>Diastolic BP *</label>
                            <input type="number" name="DiastolicBP" required step="0.1" min="40" max="130" value="85">
                            <div class="input-hint">40-130 mmHg</div>
                        </div>
                        <div class="form-group">
                            <label>Total Cholesterol *</label>
                            <input type="number" name="CholesterolTotal" required step="0.1" min="100" max="400" value="210">
                            <div class="input-hint">100-400 mg/dL</div>
                        </div>
                        <div class="form-group">
                            <label>LDL Cholesterol *</label>
                            <input type="number" name="CholesterolLDL" required step="0.1" min="50" max="250" value="135">
                            <div class="input-hint">50-250 mg/dL</div>
                        </div>
                        <div class="form-group">
                            <label>HDL Cholesterol *</label>
                            <input type="number" name="CholesterolHDL" required step="0.1" min="20" max="100" value="48">
                            <div class="input-hint">20-100 mg/dL</div>
                        </div>
                        <div class="form-group">
                            <label>Triglycerides *</label>
                            <input type="number" name="CholesterolTriglycerides" required step="0.1" min="50" max="500" value="165">
                            <div class="input-hint">50-500 mg/dL</div>
                        </div>
                    </div>

                    <!-- Cognitive Assessments -->
                    <div class="section-title">üß© Cognitive Assessments</div>
                    <div class="grid-2">
                        <div class="form-group">
                            <label>MMSE Score *</label>
                            <input type="number" name="MMSE" required step="0.1" min="0" max="30" value="22">
                            <div class="input-hint">0-30 (lower = more impairment)</div>
                        </div>
                        <div class="form-group">
                            <label>Functional Assessment *</label>
                            <input type="number" name="FunctionalAssessment" required step="0.1" min="0" max="10" value="4.5">
                            <div class="input-hint">0-10 score</div>
                        </div>
                        <div class="form-group">
                            <label>ADL Score *</label>
                            <input type="number" name="ADL" required step="0.1" min="0" max="10" value="5.2">
                            <div class="input-hint">Activities of Daily Living (0-10)</div>
                        </div>
                    </div>

                    <!-- Symptoms -->
                    <div class="section-title">‚ö†Ô∏è Clinical Symptoms</div>
                    <div class="grid-2">
                        <div class="form-group">
                            <label>Memory Complaints *</label>
                            <select name="MemoryComplaints" required>
                                <option value="0">No</option>
                                <option value="1" selected>Yes</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Behavioral Problems *</label>
                            <select name="BehavioralProblems" required>
                                <option value="0">No</option>
                                <option value="1" selected>Yes</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Confusion *</label>
                            <select name="Confusion" required>
                                <option value="0">No</option>
                                <option value="1" selected>Yes</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Disorientation *</label>
                            <select name="Disorientation" required>
                                <option value="0" selected>No</option>
                                <option value="1">Yes</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Personality Changes *</label>
                            <select name="PersonalityChanges" required>
                                <option value="0">No</option>
                                <option value="1" selected>Yes</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Difficulty Completing Tasks *</label>
                            <select name="DifficultyCompletingTasks" required>
                                <option value="0">No</option>
                                <option value="1" selected>Yes</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Forgetfulness *</label>
                            <select name="Forgetfulness" required>
                                <option value="0">No</option>
                                <option value="1" selected>Yes</option>
                            </select>
                        </div>
                    </div>

                    <div class="button-group">
                        <button type="button" class="btn-example" onclick="loadExample()">Load Example</button>
                        <button type="button" class="btn-secondary" onclick="resetForm()">Reset Form</button>
                        <button type="submit" class="btn-primary" id="submitBtn">Analyze Patient</button>
                    </div>
                </form>
            </div>

            <div class="result-section">
                <h3 style="margin-bottom: 20px; color: #333;">üìä Diagnosis Results</h3>
                <div id="resultContainer">
                    <div class="placeholder-text">
                        <p>Fill out the clinical form and click "Analyze Patient" to get diagnosis results.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_URL = 'http://127.0.0.1:8000';

        document.getElementById('clinicalForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            await analyzePatient();
        });

        async function analyzePatient() {
            const form = document.getElementById('clinicalForm');
            const formData = new FormData(form);
            const data = {};

            // Convert form data to object with proper types
            for (let [key, value] of formData.entries()) {
                // Convert to appropriate type (int or float)
                if (['Age', 'Gender', 'Ethnicity', 'EducationLevel', 'Smoking', 
                     'FamilyHistoryAlzheimers', 'CardiovascularDisease', 'Diabetes', 
                     'Depression', 'HeadInjury', 'Hypertension', 'MemoryComplaints', 
                     'BehavioralProblems', 'Confusion', 'Disorientation', 
                     'PersonalityChanges', 'DifficultyCompletingTasks', 'Forgetfulness'].includes(key)) {
                    data[key] = parseInt(value);
                } else {
                    data[key] = parseFloat(value);
                }
            }

            // Show loading state
            document.getElementById('resultContainer').innerHTML = `
                <div class="loading">
                    <div class="spinner"></div>
                    <p>Analyzing clinical data...</p>
                </div>
            `;

            document.getElementById('submitBtn').disabled = true;

            try {
                const response = await fetch(`${API_URL}/predict-clinical`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });

                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.detail || 'Analysis failed');
                }

                const result = await response.json();
                displayResult(result);

            } catch (error) {
                document.getElementById('resultContainer').innerHTML = `
                    <div class="error-message">
                        <strong>Error:</strong> ${error.message}<br>
                        <small>Make sure the backend server is running on port 8002</small>
                    </div>
                `;
            } finally {
                document.getElementById('submitBtn').disabled = false;
            }
        }

        function displayResult(result) {
            const isDiagnosisPositive = result.diagnosis === 'Positive';
            const riskClass = getRiskClass(result.risk_level);

            document.getElementById('resultContainer').innerHTML = `
                <div class="result-container">
                    <div class="result-title">Diagnosis</div>
                    <div class="diagnosis-badge ${isDiagnosisPositive ? 'diagnosis-positive' : 'diagnosis-negative'}">
                        ${result.diagnosis}
                    </div>
                    
                    <div class="result-title" style="margin-top: 20px;">Confidence Level</div>
                    <div class="confidence-bar">
                        <div class="confidence-fill" style="width: ${result.confidence}%">
                            ${result.confidence}%
                        </div>
                    </div>

                    <div class="result-title" style="margin-top: 20px;">Risk Assessment</div>
                    <span class="risk-indicator ${riskClass}">${result.risk_level} Risk</span>

                    <div class="result-title" style="margin-top: 20px;">Clinical Summary</div>
                    <div class="metric">
                        <span class="metric-label">Prediction Code:</span>
                        <span class="metric-value">${result.prediction}</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Status:</span>
                        <span class="metric-value">${result.message}</span>
                    </div>
                </div>
            `;
        }

        function getRiskClass(riskLevel) {
            const level = riskLevel.toLowerCase();
            if (level.includes('high')) return 'risk-high';
            if (level.includes('moderate')) return 'risk-moderate';
            if (level.includes('low') && !level.includes('very')) return 'risk-low';
            return 'risk-very-low';
        }

        async function loadExample() {
            try {
                const response = await fetch(`${API_URL}/example-patient`);
                const example = await response.json();

                // Fill form with example data
                const form = document.getElementById('clinicalForm');
                for (let [key, value] of Object.entries(example)) {
                    const input = form.elements[key];
                    if (input) input.value = value;
                }

                alert('Example patient data loaded! Click "Analyze Patient" to test.');
            } catch (error) {
                alert('Could not load example data. Make sure backend is running.');
            }
        }

        function resetForm() {
            document.getElementById('clinicalForm').reset();
            document.getElementById('resultContainer').innerHTML = `
                <div class="placeholder-text">
                    <p>Fill out the clinical form and click "Analyze Patient" to get diagnosis results.</p>
                </div>
            `;
        }
    </script>
</body>
</html>